import { expect } from "chai";
import { functions } from "../../src/plugins/ampljs/ampl";


describe('get top and bottom nodes of flow', function () {
    context('top and bottom node of production flow', function () {
        it('should have keys bottom.name and top.name', function () {
            expect(functions.getTopAndBottomNodesOfFlow(functions.removeUselessCharsInNodeName("n_101_PuPp_Puerpério de primíparas.-n_85_MoPp_Monta de primíparas paridas.", 'flow'), _nodes))
                .to.have.nested.property('bottom').that.is.an('object').and.has.property('name')
        })
    })

    context('top and bottom node of treatment flow', () => {
        it('should have keys bottom.name and top.name', () => {
            expect(functions.getTopAndBottomNodesOfFlow(functions.removeUselessCharsInNodeName("n_76_GeMs_Gestação na seca de multíparas solteiras.-s_92_3_Mp_Balanço de multíparas paridas.", 'flow'), _nodes))
                .to
                .have
                .nested
                .property('bottom.name', 'n_76_GeMs')
        })
    })

    context('invalid bottom flow', () => {
        it('should be empty object', () => {
            expect(functions.getTopAndBottomNodesOfFlow("n_a_PuPp_Puerpério de primíparas.-n_85_MoPp_Monta de Primíparas paridas.", _nodes)).to.be.an('object').that.is.empty
        })
    })

    context('invalid top flow', () => {
        it('should be bottom != null', () => {
            expect(functions.getTopAndBottomNodesOfFlow("n_76_GeMs_Gestação na seca de multíparas solteiras.-s_00_3_Mp_Balanço de multíparas paridas.", _nodes)).to.be.an('object').that.is.empty
        })
    })
})


const _nodes = JSON.parse(`{"n_1_VeBg":{"name":"n_1_VeBg","type":"terminal","stage":"terminal","duration":200,"formula":"CONFINAMENTO+INICIO_AGUAS","flows":["n_2_TeBm-n_1_VeBg"]},"n_2_TeBm":{"name":"n_2_TeBm","type":"station","stage":"Confinamento","duration":110,"formula":"CONFINAMENTO","flows":["n_2_TeBm-n_1_VeBg","n_3_AgBo-n_2_TeBm"]},"n_3_AgBo":{"name":"n_3_AgBo","type":"station","stage":"Recria nas águas","duration":212,"formula":"AGUAS","flows":["n_3_AgBo-n_2_TeBm","n_8_SeBo-n_3_AgBo"]},"n_8_SeBo":{"name":"n_8_SeBo","type":"station","stage":"Recria na seca","duration":153,"formula":"SECA","flows":["n_8_SeBo-n_3_AgBo","b_12_1_Bo-n_8_SeBo"]},"b_12_1_Bo":{"name":"b_12_1_Bo","type":"balance","stage":"Balanço","duration":0,"formula":"0","flows":["b_12_1_Bo-n_8_SeBo","n_16_AlMp-b_12_1_Bo","s_53_1_Bo-b_12_1_Bo"]},"n_16_AlMp":{"name":"n_16_AlMp","type":"station","stage":"Aleitamento","duration":31,"formula":"FIM_AGUAS","flows":["n_16_AlMp-b_12_1_Bo","n_17_DiMp-n_16_AlMp","n_16_AlMp-n_18_ReMs","n_16_AlMp-n_19_BaMp","n_16_AlMp-s_20_10_GeMs","n_16_AlMp-s_21_4_EnMs"]},"n_17_DiMp":{"name":"n_17_DiMp","type":"station","stage":"Diagnose","duration":59,"formula":"DIAGNOSE","flows":["n_17_DiMp-n_16_AlMp","n_25_MoMp-n_17_DiMp","n_17_DiMp-s_26_9_GaMs","n_17_DiMp-s_27_6_EaMs1"]},"n_25_MoMp":{"name":"n_25_MoMp","type":"station","stage":"Monta","duration":92,"formula":"MONTA","flows":["n_25_MoMp-n_17_DiMp","n_35_PuMp-n_25_MoMp","n_25_MoMp-s_36_8_DiMs"]},"n_35_PuMp":{"name":"n_35_PuMp","type":"station","stage":"Puerpério","duration":30,"formula":"PUERPERIO","flows":["n_35_PuMp-n_25_MoMp","b_42_3_Mp-n_35_PuMp","n_35_PuMp-s_31_7_MoMs","n_35_PuMp-n_44_AlMv"]},"b_42_3_Mp":{"name":"b_42_3_Mp","type":"balance","stage":"Balanço","duration":0,"formula":"0","flows":["b_42_3_Mp-n_35_PuMp","n_48_GePs-b_42_3_Mp","s_92_3_Mp-b_42_3_Mp"]},"n_48_GePs":{"name":"n_48_GePs","type":"station","stage":"Gestação na seca","duration":153,"formula":"SECA","flows":["n_48_GePs-b_42_3_Mp","n_59_AlPp-n_48_GePs","n_48_GePs-s_72_14_RaPs2"]},"n_59_AlPp":{"name":"n_59_AlPp","type":"station","stage":"Aleitamento","duration":31,"formula":"FIM_AGUAS","flows":["n_59_AlPp-n_48_GePs","n_69_DiPp-n_59_AlPp","n_59_AlPp-s_53_1_Bo","n_59_AlPp-n_19_BaPp","n_59_AlPp-s_72_14_RePs"]},"n_69_DiPp":{"name":"n_69_DiPp","type":"station","stage":"Diagnose","duration":59,"formula":"DIAGNOSE","flows":["n_69_DiPp-n_59_AlPp","n_85_MoPp-n_69_DiPp","n_69_DiPp-s_86_11_GaPs"]},"n_85_MoPp":{"name":"n_85_MoPp","type":"station","stage":"Monta","duration":92,"formula":"MONTA","flows":["n_85_MoPp-n_69_DiPp","n_101_PuPp-n_85_MoPp","n_85_MoPp-s_102_16_DiPs"]},"n_101_PuPp":{"name":"n_101_PuPp","type":"station","stage":"Puerpério","duration":30,"formula":"PUERPERIO","flows":["n_101_PuPp-n_85_MoPp","n_112_GeNu-n_101_PuPp","n_101_PuPp-s_169_12_MoPs"]},"n_112_GeNu":{"name":"n_112_GeNu","type":"station","stage":"Gestação na seca","duration":153,"formula":"SECA","flows":["n_112_GeNu-n_101_PuPp","n_112_GaNu-n_112_GeNu","n_112_GeNu-s_118_13_EaNu2"]},"n_112_GaNu":{"name":"n_112_GaNu","type":"station","stage":"Gestação na seca","duration":31,"formula":"FIM_AGUAS","flows":["n_112_GaNu-n_112_GeNu","n_117_DiNu-n_112_GaNu","n_112_GaNu-s_118_13_EnNu"]},"n_117_DiNu":{"name":"n_117_DiNu","type":"station","stage":"Diagnose","duration":59,"formula":"DIAGNOSE","flows":["n_117_DiNu-n_112_GaNu","n_128_MoNu-n_117_DiNu","n_117_DiNu-n_129_EaNu1"]},"n_128_MoNu":{"name":"n_128_MoNu","type":"station","stage":"Monta","duration":92,"formula":"MONTA","flows":["n_128_MoNu-n_117_DiNu","n_138_AgNu-n_128_MoNu"]},"n_138_AgNu":{"name":"n_138_AgNu","type":"station","stage":"Recria nas águas","duration":30,"formula":"PUERPERIO","flows":["n_138_AgNu-n_128_MoNu","n_156_SeNu-n_138_AgNu"]},"n_156_SeNu":{"name":"n_156_SeNu","type":"station","stage":"Recria na seca","duration":153,"formula":"SECA","flows":["n_156_SeNu-n_138_AgNu","n_173_AgBa-n_156_SeNu"]},"n_173_AgBa":{"name":"n_173_AgBa","type":"station","stage":"Recria nas águas","duration":212,"formula":"AGUAS","flows":["n_173_AgBa-n_156_SeNu","n_185_SeBa-n_173_AgBa"]},"n_185_SeBa":{"name":"n_185_SeBa","type":"station","stage":"Recria na seca","duration":153,"formula":"SECA","flows":["n_185_SeBa-n_173_AgBa","n_207_CoBa-n_185_SeBa"]},"n_207_CoBa":{"name":"n_207_CoBa","type":"station","stage":"terminal","duration":0,"formula":"0","flows":["n_207_CoBa-n_185_SeBa"]},"n_129_EaNu1":{"name":"n_129_EaNu1","type":"station","stage":"Engorda nas águas","duration":31,"formula":"FIM_AGUAS","flows":["n_117_DiNu-n_129_EaNu1","n_129_EaNu1-s_118_13_EnNu"]},"s_118_13_EnNu":{"name":"s_118_13_EnNu","type":"sum","stage":"Engorda na seca","duration":0,"formula":"0","flows":["n_129_EaNu1-s_118_13_EnNu","s_118_13_EnNu-n_144_EnNu","n_112_GaNu-s_118_13_EnNu"]},"n_144_EnNu":{"name":"n_144_EnNu","type":"station","stage":"Engorda na seca","duration":153,"formula":"SECA","flows":["s_118_13_EnNu-n_144_EnNu","n_144_EnNu-s_118_13_EaNu2"]},"s_118_13_EaNu2":{"name":"s_118_13_EaNu2","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_144_EnNu-s_118_13_EaNu2","s_118_13_EaNu2-n_144_EaNu2","n_112_GeNu-s_118_13_EaNu2"]},"n_144_EaNu2":{"name":"n_144_EaNu2","type":"station","stage":"Engorda nas águas","duration":30,"formula":"PUERPERIO","flows":["s_118_13_EaNu2-n_144_EaNu2","n_144_EaNu2-n_162_VeNg"]},"n_162_VeNg":{"name":"n_162_VeNg","type":"terminal","stage":"terminal","duration":0,"formula":"0","flows":["n_144_EaNu2-n_162_VeNg"]},"s_169_12_MoPs":{"name":"s_169_12_MoPs","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_101_PuPp-s_169_12_MoPs","s_169_12_MoPs-n_113_MoPs","n_152_RaPs2-s_169_12_MoPs"]},"n_113_MoPs":{"name":"n_113_MoPs","type":"station","stage":"Monta","duration":92,"formula":"MONTA","flows":["s_169_12_MoPs-n_113_MoPs","n_113_MoPs-s_102_16_DiPs"]},"s_102_16_DiPs":{"name":"s_102_16_DiPs","type":"sum","stage":"Diagnose","duration":0,"formula":"0","flows":["n_113_MoPs-s_102_16_DiPs","s_102_16_DiPs-n_122_DiPs","n_85_MoPp-s_102_16_DiPs"]},"n_122_DiPs":{"name":"n_122_DiPs","type":"station","stage":"Diagnose","duration":59,"formula":"DIAGNOSE","flows":["s_102_16_DiPs-n_122_DiPs","n_122_DiPs-s_86_11_GaPs","n_122_DiPs-n_134_RaPs1","n_122_DiPs-n_190_EaPs1"]},"s_86_11_GaPs":{"name":"s_86_11_GaPs","type":"sum","stage":"Gestação nas águas","duration":0,"formula":"0","flows":["n_122_DiPs-s_86_11_GaPs","s_86_11_GaPs-n_133_GaPs","n_69_DiPp-s_86_11_GaPs"]},"n_133_GaPs":{"name":"n_133_GaPs","type":"station","stage":"Gestação nas águas","duration":31,"formula":"FIM_AGUAS","flows":["s_86_11_GaPs-n_133_GaPs","n_133_GaPs-n_133_GePs1","n_133_GaPs-s_72_14_RePs","n_133_GaPs-s_199_17_EnPs"]},"n_133_GePs1":{"name":"n_133_GePs1","type":"station","stage":"Gestação nas águas","duration":153,"formula":"SECA","flows":["n_133_GaPs-n_133_GePs1","n_133_GePs1-s_92_3_Mp","n_133_GePs1-s_72_14_RaPs2","n_133_GePs1-s_199_17_EaPs2"]},"n_134_RaPs1":{"name":"n_134_RaPs1","type":"station","stage":"Reserva nas águas","duration":31,"formula":"FIM_AGUAS","flows":["n_122_DiPs-n_134_RaPs1","n_134_RaPs1-s_72_14_RePs"]},"s_72_14_RePs":{"name":"s_72_14_RePs","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_134_RaPs1-s_72_14_RePs","s_72_14_RePs-n_152_RePs","n_59_AlPp-s_72_14_RePs","n_133_GaPs-s_72_14_RePs"]},"n_152_RePs":{"name":"n_152_RePs","type":"station","stage":"Reserva na seca","duration":153,"formula":"SECA","flows":["s_72_14_RePs-n_152_RePs","n_152_RePs-s_72_14_RaPs2"]},"s_72_14_RaPs2":{"name":"s_72_14_RaPs2","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_152_RePs-s_72_14_RaPs2","s_72_14_RaPs2-n_152_RaPs2","n_48_GePs-s_72_14_RaPs2","n_133_GePs1-s_72_14_RaPs2"]},"n_152_RaPs2":{"name":"n_152_RaPs2","type":"station","stage":"Reserva nas águas","duration":30,"formula":"PUERPERIO","flows":["s_72_14_RaPs2-n_152_RaPs2","n_152_RaPs2-s_169_12_MoPs"]},"n_190_EaPs1":{"name":"n_190_EaPs1","type":"station","stage":"Engorda nas águas","duration":31,"formula":"FIM_AGUAS","flows":["n_122_DiPs-n_190_EaPs1","n_190_EaPs1-s_199_17_EnPs"]},"s_199_17_EnPs":{"name":"s_199_17_EnPs","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_190_EaPs1-s_199_17_EnPs","s_199_17_EnPs-n_203_EnPs","n_133_GaPs-s_199_17_EnPs"]},"n_203_EnPs":{"name":"n_203_EnPs","type":"station","stage":"Engorda na seca","duration":153,"formula":"SECA","flows":["s_199_17_EnPs-n_203_EnPs","n_203_EnPs-s_199_17_EaPs2"]},"s_199_17_EaPs2":{"name":"s_199_17_EaPs2","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_203_EnPs-s_199_17_EaPs2","s_199_17_EaPs2-n_203_EaPs2","n_133_GePs1-s_199_17_EaPs2"]},"n_203_EaPs2":{"name":"n_203_EaPs2","type":"station","stage":"Engorda na seca","duration":30,"formula":"PUERPERIO","flows":["s_199_17_EaPs2-n_203_EaPs2","n_203_EaPs2-n_209_VePg"]},"n_209_VePg":{"name":"n_209_VePg","type":"terminal","stage":"terminal","duration":0,"formula":"0","flows":["n_203_EaPs2-n_209_VePg"]},"n_44_AlMv":{"name":"n_44_AlMv","type":"station","stage":"Aleitamento","duration":182,"formula":"AGUAS-PUERPERIO","flows":["n_35_PuMp-n_44_AlMv","n_44_AlMv-s_53_1_Bo","n_44_AlMv-n_19_BaMv","n_44_AlMv-s_21_4_EnMs"]},"s_31_7_MoMs":{"name":"s_31_7_MoMs","type":"sum","stage":"Monta","duration":0,"formula":"0","flows":["n_35_PuMp-s_31_7_MoMs","s_31_7_MoMs-n_43_MoMs","n_18_RaMs-s_31_7_MoMs"]},"n_43_MoMs":{"name":"n_43_MoMs","type":"station","stage":"Monta","duration":92,"formula":"MONTA","flows":["s_31_7_MoMs-n_43_MoMs","n_43_MoMs-s_36_8_DiMs"]},"s_36_8_DiMs":{"name":"s_36_8_DiMs","type":"sum","stage":"Diagnose","duration":0,"formula":"0","flows":["n_43_MoMs-s_36_8_DiMs","s_36_8_DiMs-n_49_DiMs","n_25_MoMp-s_36_8_DiMs"]},"n_49_DiMs":{"name":"n_49_DiMs","type":"station","stage":"Diagnose","duration":59,"formula":"DIAGNOSE","flows":["s_36_8_DiMs-n_49_DiMs","n_49_DiMs-s_26_9_GaMs","n_49_DiMs-s_27_6_EaMs1"]},"s_26_9_GaMs":{"name":"s_26_9_GaMs","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_49_DiMs-s_26_9_GaMs","s_26_9_GaMs-n_64_GaMs","n_17_DiMp-s_26_9_GaMs"]},"n_64_GaMs":{"name":"n_64_GaMs","type":"station","stage":"Gestação nas águas","duration":31,"formula":"FIM_AGUAS","flows":["s_26_9_GaMs-n_64_GaMs","n_64_GaMs-s_20_10_GeMs","n_64_GaMs-s_21_4_EnMs"]},"s_20_10_GeMs":{"name":"s_20_10_GeMs","type":"sum","stage":"Gestação na seca","duration":0,"formula":"0","flows":["n_64_GaMs-s_20_10_GeMs","s_20_10_GeMs-n_76_GeMs","n_16_AlMp-s_20_10_GeMs"]},"n_76_GeMs":{"name":"n_76_GeMs","type":"station","stage":"Gestação na seca","duration":153,"formula":"SECA","flows":["s_20_10_GeMs-n_76_GeMs","n_76_GeMs-s_92_3_Mp","n_76_GeMs-s_93_5_EaMs2"]},"s_27_6_EaMs1":{"name":"s_27_6_EaMs1","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_17_DiMp-s_27_6_EaMs1","s_27_6_EaMs1-n_65_EaMs1","n_49_DiMs-s_27_6_EaMs1"]},"n_65_EaMs1":{"name":"n_65_EaMs1","type":"station","stage":"Engorda nas águas","duration":31,"formula":"FIM_AGUAS","flows":["s_27_6_EaMs1-n_65_EaMs1","n_65_EaMs1-s_21_4_EnMs"]},"s_21_4_EnMs":{"name":"s_21_4_EnMs","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_65_EaMs1-s_21_4_EnMs","s_21_4_EnMs-n_81_EnMs","n_16_AlMp-s_21_4_EnMs","n_44_AlMv-s_21_4_EnMs","n_64_GaMs-s_21_4_EnMs"]},"n_81_EnMs":{"name":"n_81_EnMs","type":"station","stage":"Engorda na seca","duration":153,"formula":"SECA","flows":["s_21_4_EnMs-n_81_EnMs","n_81_EnMs-s_93_5_EaMs2"]},"s_93_5_EaMs2":{"name":"s_93_5_EaMs2","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_81_EnMs-s_93_5_EaMs2","s_93_5_EaMs2-n_97_EaMs2","n_76_GeMs-s_93_5_EaMs2"]},"n_97_EaMs2":{"name":"n_97_EaMs2","type":"station","stage":"Engorda nas águas","duration":30,"formula":"PUERPERIO","flows":["s_93_5_EaMs2-n_97_EaMs2","n_97_EaMs2-n_108_VeMg"]},"n_108_VeMg":{"name":"n_108_VeMg","type":"terminal","stage":"terminal","duration":0,"formula":"0","flows":["n_97_EaMs2-n_108_VeMg"]},"n_18_ReMs":{"name":"n_18_ReMs","type":"station","stage":"Reserva na seca","duration":153,"formula":"SECA","flows":["n_16_AlMp-n_18_ReMs","n_18_ReMs-n_18_RaMs"]},"n_18_RaMs":{"name":"n_18_RaMs","type":"station","stage":"Reserva nas águas","duration":30,"formula":"PUERPERIO","flows":["n_18_ReMs-n_18_RaMs","n_18_RaMs-s_31_7_MoMs"]},"s_53_1_Bo":{"name":"s_53_1_Bo","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_44_AlMv-s_53_1_Bo","s_53_1_Bo-b_12_1_Bo","n_59_AlPp-s_53_1_Bo"]},"n_19_BaMp":{"name":"n_19_BaMp","type":"terminal","stage":"terminal","duration":0,"formula":"0","flows":["n_16_AlMp-n_19_BaMp"]},"n_19_BaMv":{"name":"n_19_BaMv","type":"terminal","stage":"terminal","duration":0,"formula":"0","flows":["n_44_AlMv-n_19_BaMv"]},"n_19_BaPp":{"name":"n_19_BaPp","type":"terminal","stage":"terminal","duration":0,"formula":"0","flows":["n_59_AlPp-n_19_BaPp"]},"s_92_3_Mp":{"name":"s_92_3_Mp","type":"sum","stage":"(nenhuma)","duration":0,"formula":"0","flows":["n_76_GeMs-s_92_3_Mp","s_92_3_Mp-b_42_3_Mp","n_133_GePs1-s_92_3_Mp"]}}`)